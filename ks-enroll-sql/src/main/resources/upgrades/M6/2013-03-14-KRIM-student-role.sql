--KS Student Role
CREATE OR REPLACE PROCEDURE "LEVEL_SEQUENCES" (TABLE_ID VARCHAR2, SEQUENCE_ID VARCHAR2,PK VARCHAR2) IS
    STATEMENT VARCHAR2(2000);
    maxid NUMBER;
    cval NUMBER;
BEGIN
    STATEMENT:= 'SELECT MAX(TO_NUMBER('||TABLE_ID||'.'||PK||')) FROM '||TABLE_ID||' WHERE '||TABLE_ID||'.'||PK||' NOT LIKE ''KR%''';
    EXECUTE IMMEDIATE (STATEMENT) INTO maxid;
    STATEMENT := 'SELECT '|| SEQUENCE_ID ||'.NEXTVAL FROM DUAL';
    EXECUTE IMMEDIATE(STATEMENT) INTO cval;
    IF cval!=maxid
    THEN
    STATEMENT := 'ALTER SEQUENCE '|| SEQUENCE_ID || ' INCREMENT BY ' || (maxid-cval);
    EXECUTE IMMEDIATE(STATEMENT);
    STATEMENT := 'SELECT '|| SEQUENCE_ID ||'.NEXTVAL FROM DUAL';
    EXECUTE IMMEDIATE(STATEMENT) INTO cval;
    STATEMENT := 'ALTER SEQUENCE '|| SEQUENCE_ID || ' INCREMENT BY 1';
    EXECUTE IMMEDIATE(STATEMENT);
    END IF;
END;
/
CALL LEVEL_SEQUENCES('KRIM_ROLE_T','KRIM_ROLE_ID_S','ROLE_ID')
/
insert into KRIM_ROLE_T (ROLE_ID, OBJ_ID, VER_NBR, ROLE_NM, NMSPC_CD, DESC_TXT, KIM_TYP_ID, ACTV_IND, LAST_UPDT_DT) values (KRIM_ROLE_ID_S.NEXTVAL,  SYS_GUID(), 1, 'KS Student', 'KS-SYS', 'A student ', '1', 'Y', TO_DATE ('11/26/2012', 'MM/DD/YYYY') )
/
insert into KRIM_ROLE_MBR_T (ROLE_MBR_ID, VER_NBR, OBJ_ID, ROLE_ID, MBR_ID, MBR_TYP_CD, ACTV_FRM_DT, ACTV_TO_DT, LAST_UPDT_DT) values (KRIM_ROLE_MBR_ID_S.NEXTVAL, 1, SYS_GUID(), (SELECT ROLE_ID FROM KRIM_ROLE_T where ROLE_NM = 'KS Student' and nmspc_cd = 'KS-SYS'), 'student', 'P', '', '', TO_DATE('10/24/2012', 'MM/DD/YYYY'))
/
