SQL> 
SQL> ALTER SESSION SET CURRENT_SCHEMA=KSBUNDLED
  2  /

Session altered.

SQL> --KSEN_ORG
SQL> ALTER TABLE KSOR_ORG RENAME TO KSEN_ORG
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG RENAME COLUMN TYPE TO ORG_TYPE
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG RENAME COLUMN ST TO ORG_STATE
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG RENAME COLUMN LNG_NAME TO LONG_NAME
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG RENAME COLUMN LNG_DESCR TO LONG_DESCR_PLAIN
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG RENAME COLUMN SHRT_NAME TO SHORT_NAME
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG RENAME COLUMN SHRT_DESCR TO SHORT_DESCR_PLAIN
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG ADD (LONG_DESCR_FORMATTED VARCHAR2(4000) NULL,
  2  			       SORT_NAME VARCHAR2(255) NULL,
  3  			       SHORT_DESCR_FORMATTED VARCHAR2(4000) NULL)
  4  /

Table altered.

SQL> --remove foreign key constraint that points to a custom type table that is no longer needed
SQL> ALTER TABLE KSEN_ORG DROP CONSTRAINT KSOR_ORG_FK1
  2  /

Table altered.

SQL> 
SQL> --Move types from custom org type table into the standard type table.
SQL> INSERT INTO KSEN_TYPE
  2  (TYPE_KEY, NAME, DESCR_PLAIN, REF_OBJECT_URI, SERVICE_URI, EFF_DT, EXPIR_DT, VER_NBR, CREATEID, CREATETIME)
  3  SELECT TYPE_KEY, NAME, TYPE_DESC, 'http://student.kuali.org/wsdl/organization/OrgInfo', 'http://student.kuali.org/wsdl/organization/OrganizationService', EFF_DT, EXPIR_DT, VER_NBR, 'SYSTEMLOADER',TO_DATE('20130731', 'YYYYMMDD')
  4  FROM KSOR_ORG_TYPE WHERE TYPE_KEY NOT IN (SELECT TYPE_KEY FROM KSEN_TYPE)
  5  /

24 rows created.

SQL> --Move type attrs from custom table into the standard type attr table.
SQL> INSERT INTO KSEN_TYPE_ATTR
  2  (ID, OWNER_ID, ATTR_KEY, ATTR_VALUE)
  3  SELECT SYS_GUID() ID, attr.OWNER, attr.ATTR_NAME, attr.ATTR_VALUE
  4  FROM KSOR_ORG_TYPE_ATTR attr
  5  WHERE NOT EXISTS (SELECT 'X' FROM KSEN_TYPE_ATTR attrInner WHERE attr.OWNER = attrInner.OWNER_ID AND attr.ATTR_NAME = attrInner.ATTR_KEY)
  6  /

0 rows created.

SQL> 
SQL> --KSEN_ORG_ATTR
SQL> ALTER TABLE KSOR_ORG_ATTR RENAME TO KSEN_ORG_ATTR
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_ATTR RENAME COLUMN OWNER TO OWNER_ID
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_ATTR RENAME COLUMN ATTR_NAME TO ATTR_KEY
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_ATTR DROP COLUMN VER_NBR
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_ATTR MODIFY ATTR_VALUE VARCHAR2(4000)
  2  /

Table altered.

SQL> 
SQL> --KSEN_ORG_CD
SQL> CREATE TABLE KSEN_ORG_CD
  2  (
  3  	     ID 		  VARCHAR2(255) NOT NULL ,
  4  	     OBJ_ID		  VARCHAR2(36) NULL ,
  5  	     ORG_CD_TYPE	  VARCHAR2(255) NOT NULL ,
  6  	     ORG_CD_STATE	  VARCHAR2(255) NOT NULL ,
  7  	     ORG_ID		  VARCHAR2(255) NOT NULL ,
  8  	     VALUE		  VARCHAR2(255) NOT NULL ,
  9  	     DESCR_PLAIN	  VARCHAR2(4000) NULL ,
 10  	     DESCR_FORMATTED	  VARCHAR2(4000) NULL ,
 11  	     VER_NBR		  NUMBER(19) NOT NULL ,
 12  	     CREATETIME 	  TIMESTAMP(6) NOT NULL ,
 13  	     CREATEID		  VARCHAR2(255) NOT NULL ,
 14  	     UPDATETIME 	  TIMESTAMP(6) NULL ,
 15  	     UPDATEID		  VARCHAR2(255) NULL
 16  )
 17  /

Table created.

SQL> 
SQL> ALTER TABLE KSEN_ORG_CD
  2  	     ADD CONSTRAINT  KSEN_ORG_CD_P PRIMARY KEY (ID)
  3  /

Table altered.

SQL> 
SQL> DECLARE TEMP NUMBER;
  2  BEGIN
  3    SELECT COUNT(*) INTO TEMP FROM USER_TABLES WHERE TABLE_NAME = 'KSEN_ORG_CD_ATTR';
  4  	     IF TEMP > 0 THEN EXECUTE IMMEDIATE 'DROP TABLE KSEN_ORG_CD_ATTR CASCADE CONSTRAINTS PURGE'; END IF;
  5  END;
  6  /

PL/SQL procedure successfully completed.

SQL> 
SQL> 
SQL> CREATE TABLE KSEN_ORG_CD_ATTR
  2  (
  3  	     ID 		  VARCHAR2(255) NOT NULL ,
  4  	     OBJ_ID		  VARCHAR2(36) NULL ,
  5  	     ATTR_KEY		  VARCHAR2(255) NULL ,
  6  	     ATTR_VALUE 	  VARCHAR2(4000) NULL ,
  7  	     OWNER_ID		  VARCHAR2(255) NULL
  8  )
  9  /

Table created.

SQL> 
SQL> 
SQL> ALTER TABLE KSEN_ORG_CD_ATTR
  2  	     ADD CONSTRAINT  KSEN_ORG_CD_ATTR_P PRIMARY KEY (ID)
  3  /

Table altered.

SQL> 
SQL> 
SQL> --KSEN_ORG_ORG_RELTN
SQL> ALTER TABLE KSOR_ORG_ORG_RELTN RENAME TO KSEN_ORG_ORG_RELTN
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_ORG_RELTN RENAME COLUMN TYPE TO ORG_RELTN_TYPE
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_ORG_RELTN RENAME COLUMN ST TO ORG_RELTN_STATE
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_ORG_RELTN RENAME COLUMN ORG TO ORG_ID
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_ORG_RELTN RENAME COLUMN RELATED_ORG TO RELATED_ORG_ID
  2  /

Table altered.

SQL> --remove foreign key constraint that points to a custom type table that is no longer needed
SQL> ALTER TABLE KSEN_ORG_ORG_RELTN DROP CONSTRAINT KSOR_ORG_ORG_RELTN_FK3
  2  /

Table altered.

SQL> --Move types from custom org org relation type table into the standard type table.
SQL> INSERT INTO KSEN_TYPE
  2  (TYPE_KEY, NAME, DESCR_PLAIN, REF_OBJECT_URI, SERVICE_URI, EFF_DT, EXPIR_DT, VER_NBR, CREATEID, CREATETIME)
  3  SELECT TYPE_KEY, NAME, TYPE_DESC, 'http://student.kuali.org/wsdl/organization/OrgOrgRelationInfo', 'http://student.kuali.org/wsdl/organization/OrganizationService', EFF_DT, EXPIR_DT, VER_NBR, 'SYSTEMLOADER',TO_DATE('20130731', 'YYYYMMDD')
  4  FROM KSOR_ORG_ORG_RELTN_TYPE WHERE TYPE_KEY NOT IN (SELECT TYPE_KEY FROM KSEN_TYPE)
  5  /

11 rows created.

SQL> --Move type attrs from custom table into the standard type attr table.
SQL> INSERT INTO KSEN_TYPE_ATTR
  2  (ID, OWNER_ID, ATTR_KEY, ATTR_VALUE)
  3  SELECT SYS_GUID() ID, attr.OWNER, attr.ATTR_NAME, attr.ATTR_VALUE
  4  FROM KSOR_ORG_ORG_RELTN_TYPE_ATTR attr
  5  WHERE NOT EXISTS (SELECT 'X' FROM KSEN_TYPE_ATTR attrInner WHERE attr.OWNER = attrInner.OWNER_ID AND attr.ATTR_NAME = attrInner.ATTR_KEY)
  6  /

0 rows created.

SQL> 
SQL> --KSEN_ORG_ORG_REL_ATTR
SQL> ALTER TABLE KSOR_ORG_ORG_RELTN_ATTR RENAME TO KSEN_ORG_ORG_REL_ATTR
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_ORG_REL_ATTR RENAME COLUMN OWNER TO OWNER_ID
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_ORG_REL_ATTR RENAME COLUMN ATTR_NAME TO ATTR_KEY
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_ORG_REL_ATTR DROP COLUMN VER_NBR
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_ORG_REL_ATTR MODIFY ATTR_VALUE VARCHAR2(4000)
  2  /

Table altered.

SQL> 
SQL> --KSEN_ORG_HIRCHY
SQL> ALTER TABLE KSOR_ORG_HIRCHY RENAME TO KSEN_ORG_HIRCHY
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_HIRCHY RENAME COLUMN DESCR TO DESCR_PLAIN
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_HIRCHY RENAME COLUMN ROOT_ORG TO ROOT_ORG_ID
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_HIRCHY ADD (ORG_HIRCHY_TYPE VARCHAR2(255) NULL,
  2  				      ORG_HIRCHY_STATE VARCHAR2(255) NULL,
  3  				      DESCR_FORMATTED VARCHAR2(4000) NULL,
  4  				      CREATETIME TIMESTAMP(6) NULL,
  5  				      CREATEID VARCHAR2(255) NULL,
  6  				      UPDATETIME TIMESTAMP(6) NULL,
  7  				      UPDATEID VARCHAR2(255) NULL)
  8  /

Table altered.

SQL> UPDATE KSEN_ORG_HIRCHY SET ORG_HIRCHY_TYPE=ID, ORG_HIRCHY_STATE='kuali.org.hierarchy.state.active', CREATEID='SYSTEMLOADER',CREATETIME=TO_DATE('20130731', 'YYYYMMDD')
  2  /

3 rows updated.

SQL> ALTER TABLE KSEN_ORG_HIRCHY MODIFY (ORG_HIRCHY_TYPE VARCHAR2(255) NOT NULL,
  2  					 ORG_HIRCHY_STATE VARCHAR2(255) NOT NULL,
  3  					 CREATETIME TIMESTAMP(6) NOT NULL,
  4  					 CREATEID VARCHAR2(255) NOT NULL)
  5  /

Table altered.

SQL> 
SQL> --insert org hierarchy type
SQL> INSERT INTO KSEN_TYPE
  2  (TYPE_KEY, NAME, REF_OBJECT_URI, SERVICE_URI, EFF_DT, EXPIR_DT, VER_NBR, CREATEID, CREATETIME)
  3  SELECT ORG_HIRCHY_TYPE, NAME, 'http://student.kuali.org/wsdl/organization/OrgHierarchyInfo', 'http://student.kuali.org/wsdl/organization/OrganizationService', EFF_DT, EXPIR_DT, 1, 'SYSTEMLOADER',TO_DATE('20130731', 'YYYYMMDD')
  4  FROM KSEN_ORG_HIRCHY WHERE ORG_HIRCHY_TYPE NOT IN (SELECT TYPE_KEY FROM KSEN_TYPE)
  5  /

3 rows created.

SQL> 
SQL> --KSEN_ORG_HIRCHY_ATTR
SQL> ALTER TABLE KSOR_ORG_HIRCHY_ATTR RENAME TO KSEN_ORG_HIRCHY_ATTR
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_HIRCHY_ATTR RENAME COLUMN OWNER TO OWNER_ID
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_HIRCHY_ATTR RENAME COLUMN ATTR_NAME TO ATTR_KEY
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_HIRCHY_ATTR DROP COLUMN VER_NBR
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_HIRCHY_ATTR MODIFY ATTR_VALUE VARCHAR2(4000)
  2  /

Table altered.

SQL> 
SQL> 
SQL> --KSEN_ORG_HIRCHY_OORT
SQL> CREATE TABLE KSEN_ORG_HIRCHY_OORT
  2  (
  3  	     ORG_HIRCHY_ID	  VARCHAR2(255) NOT NULL ,
  4  	     ORG_ORG_RELTN_TYPE_ID VARCHAR2(255) NOT NULL
  5  )
  6  /

Table created.

SQL> 
SQL> 
SQL> ALTER TABLE KSEN_ORG_HIRCHY_OORT
  2  	     ADD CONSTRAINT  KSEN_ORG_HIRCHY_OORT_P PRIMARY KEY (ORG_HIRCHY_ID,ORG_ORG_RELTN_TYPE_ID)
  3  /

Table altered.

SQL> 
SQL> --INSERT INTO KSEN_ORG_HIRCHY_OORT
SQL> INSERT INTO KSEN_ORG_HIRCHY_OORT
  2  (ORG_HIRCHY_ID, ORG_ORG_RELTN_TYPE_ID)
  3  SELECT DISTINCT ORG_HIRCHY_ID, OOR_TYPE
  4  FROM (SELECT DISTINCT ORG.ORG_TYPE, oor.ORG_RELTN_TYPE OOR_TYPE
  5  	   FROM KSEN_ORG ORG, KSEN_ORG_ORG_RELTN OOR
  6  	   WHERE (OOR.ORG_ID = ORG.ID OR OOR.RELATED_ORG_ID = ORG.ID)) TABLE1
  7  INNER JOIN
  8  	   (SELECT * FROM KSOR_ORG_HIRCHY_JN_ORG_TYPE) TABLE2
  9  ON TABLE1.ORG_TYPE = TABLE2.ORG_TYPE_ID
 10  /

23 rows created.

SQL> 
SQL> --KSEN_ORG_PERS_RELTN
SQL> ALTER TABLE KSOR_ORG_PERS_RELTN RENAME TO KSEN_ORG_PERS_RELTN
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_PERS_RELTN RENAME COLUMN ST TO ORG_PERS_RELTN_STATE
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_PERS_RELTN RENAME COLUMN ORG TO ORG_ID
  2  /

Table altered.

SQL> --remove foreign key constraint that points to a custom type table that is no longer needed
SQL> ALTER TABLE KSEN_ORG_PERS_RELTN DROP CONSTRAINT KSOR_ORG_PERS_RELTN_FK2
  2  /

Table altered.

SQL> --Move types from custom org person relation type table into the standard type table.
SQL> INSERT INTO KSEN_TYPE
  2  (TYPE_KEY, NAME, DESCR_PLAIN, REF_OBJECT_URI, SERVICE_URI, EFF_DT, EXPIR_DT, VER_NBR, CREATEID, CREATETIME)
  3  SELECT TYPE_KEY, NAME, TYPE_DESC, 'http://student.kuali.org/wsdl/organization/OrgPersonRelationInfo', 'http://student.kuali.org/wsdl/organization/OrganizationService', EFF_DT, EXPIR_DT, VER_NBR, 'SYSTEMLOADER',TO_DATE('20130731', 'YYYYMMDD')
  4  FROM KSOR_ORG_PERS_RELTN_TYPE WHERE TYPE_KEY NOT IN (SELECT TYPE_KEY FROM KSEN_TYPE)
  5  /

27 rows created.

SQL> --Move type attrs from custom table into the standard type attr table.
SQL> INSERT INTO KSEN_TYPE_ATTR
  2  (ID, OWNER_ID, ATTR_KEY, ATTR_VALUE)
  3  SELECT SYS_GUID() ID, attr.OWNER, attr.ATTR_NAME, attr.ATTR_VALUE
  4  FROM KSOR_ORG_PERS_RELTN_TYPE_ATTR attr
  5  WHERE NOT EXISTS (SELECT 'X' FROM KSEN_TYPE_ATTR attrInner WHERE attr.OWNER = attrInner.OWNER_ID AND attr.ATTR_NAME = attrInner.ATTR_KEY)
  6  /

0 rows created.

SQL> 
SQL> --KSEN_ORG_PERS_REL_ATTR
SQL> ALTER TABLE KSOR_ORG_PERS_RELTN_ATTR RENAME TO KSEN_ORG_PERS_REL_ATTR
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_PERS_REL_ATTR RENAME COLUMN OWNER TO OWNER_ID
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_PERS_REL_ATTR RENAME COLUMN ATTR_NAME TO ATTR_KEY
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_PERS_REL_ATTR DROP COLUMN VER_NBR
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_PERS_REL_ATTR MODIFY ATTR_VALUE VARCHAR2(4000)
  2  /

Table altered.

SQL> 
SQL> --KSEN_ORG_POS_RESTR
SQL> ALTER TABLE KSOR_ORG_POS_RESTR RENAME TO KSEN_ORG_POS_RESTR
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_POS_RESTR RENAME COLUMN ORG TO ORG_ID
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_POS_RESTR RENAME COLUMN PERS_RELTN_TYPE TO ORG_PERS_RELTN_TYPE
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_POS_RESTR RENAME COLUMN TTL TO TITLE
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_POS_RESTR RENAME COLUMN DESCR TO DESCR_PLAIN
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_POS_RESTR RENAME COLUMN ATP_DUR_TYP_KEY TO STD_DUR_TYPE
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_POS_RESTR RENAME COLUMN TM_QUANTITY TO STD_DUR_TIME_QTY
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_POS_RESTR RENAME COLUMN MIN_NUM_RELTN TO MIN_NUM_REL
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_POS_RESTR ADD DESCR_FORMATTED VARCHAR2(4000) NULL
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_POS_RESTR ADD MAX_NUM_REL NUMBER
  2  /

Table altered.

SQL> UPDATE KSEN_ORG_POS_RESTR
  2  SET MAX_NUM_REL = MAX_NUM_RELTN
  3  /

191 rows updated.

SQL> ALTER TABLE KSEN_ORG_POS_RESTR DROP COLUMN MAX_NUM_RELTN
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_POS_RESTR MODIFY (STD_DUR_TIME_QTY NUMBER,
  2  					    MIN_NUM_REL NUMBER)
  3  /

Table altered.

SQL> --remove foreign key constraint that points to a custom type table that is no longer needed
SQL> ALTER TABLE KSEN_ORG_POS_RESTR DROP CONSTRAINT KSOR_ORG_POS_RESTR_FK1
  2  /

Table altered.

SQL> 
SQL> --KSEN_ORG_POS_RESTR
SQL> ALTER TABLE KSOR_ORG_POS_RESTR_ATTR RENAME TO KSEN_ORG_POS_RESTR_ATTR
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_POS_RESTR_ATTR RENAME COLUMN OWNER TO OWNER_ID
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_POS_RESTR_ATTR RENAME COLUMN ATTR_NAME TO ATTR_KEY
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_POS_RESTR_ATTR DROP COLUMN VER_NBR
  2  /

Table altered.

SQL> ALTER TABLE KSEN_ORG_POS_RESTR_ATTR MODIFY ATTR_VALUE VARCHAR2(4000)
  2  /

Table altered.

SQL> 
SQL> --DROP TABLES
SQL> DROP TABLE KSOR_ORG_JN_ORG_PERS_REL_TYPE
  2  /

Table dropped.

SQL> DROP TABLE KSOR_ORG_HIRCHY_JN_ORG_TYPE
  2  /

Table dropped.

SQL> DROP TABLE KSOR_ORG_TYPE_JN_ORG_PERRL_TYP
  2  /

Table dropped.

SQL> DROP TABLE KSOR_ORG_TYPE_ATTR
  2  /

Table dropped.

SQL> DROP TABLE KSOR_ORG_TYPE
  2  /

Table dropped.

SQL> DROP TABLE KSOR_ORG_ORG_RELTN_TYPE_ATTR
  2  /

Table dropped.

SQL> DROP TABLE KSOR_ORG_ORG_RELTN_TYPE
  2  /

Table dropped.

SQL> DROP TABLE KSOR_ORG_PERS_RELTN_TYPE_ATTR
  2  /

Table dropped.

SQL> DROP TABLE KSOR_ORG_PERS_RELTN_TYPE
  2  /

Table dropped.

SQL> quit
